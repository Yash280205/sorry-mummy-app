<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A Special Message for Mom</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; margin: 0; padding: 20px; text-align: center;
    }
    .container {
      background: white; padding: 30px 40px; border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      max-width: 400px; width: 90%;
    }
    h1 { color: #333; margin-bottom: 20px; }
    p { color: #666; }
    .input-group { margin-bottom: 15px; text-align: left; }
    label { display: block; margin-bottom: 5px; color: #555; font-weight: 600; }
    input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
    button {
      width: 100%; padding: 12px; border: none; border-radius: 8px;
      background: #007bff; color: white; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: background 0.3s; margin-top: 10px;
    }
    button:hover { background: #0056b3; }
    #link-container { margin-top: 20px; padding: 15px; background: #e9ecef;
      border: 1px dashed #ced4da; border-radius: 8px; word-wrap: break-word; }
    #final-message h1 { font-size: 2.5em; color: #ff69b4; animation: fadeIn 2s; }
    #final-message p { font-size: 1.2em; line-height: 1.6; animation: fadeIn 3s; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  </style>
</head>
<body>
  <div class="container" id="main-container">
    <!-- Setup View -->
    <div id="setup-view">
      <h1>Create Your Apology Link</h1>
      <p>Fill this form to generate a special link for your mom.</p>
      <div class="input-group"><label>Mom's Name:</label><input type="text" id="momName"></div>
      <div class="input-group"><label>Your Name:</label><input type="text" id="sonName"></div>
      <div class="input-group"><label>Mom's Age:</label><input type="number" id="momAge"></div>
      <div class="input-group"><label>Your Age:</label><input type="number" id="sonAge"></div>
      <button onclick="generateLink()">Generate Link</button>
      <div id="link-container" style="display:none;">
        <p>Send this short link to her:</p>
        <span id="generated-link"></span>
      </div>
    </div>

    <!-- Login View -->
    <div id="login-view" style="display:none;">
      <h1>Just a Quick Check</h1>
      <p>Please confirm details to see the message.</p>
      <div class="input-group"><label>Your Name:</label><input type="text" id="momNameGuess"></div>
      <div class="input-group"><label>Your Son's Name:</label><input type="text" id="sonNameGuess"></div>
      <div class="input-group"><label>Your Age:</label><input type="number" id="momAgeGuess"></div>
      <div class="input-group"><label>Son's Age:</label><input type="number" id="sonAgeGuess"></div>
      <button onclick="checkDetails()">Next</button>
    </div>

    <!-- Final Message -->
    <div id="final-message" style="display:none;"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <script>
    // Utility: create short random key
    function shortKey(length=6) {
      return Math.random().toString(36).substring(2, 2+length);
    }

    // When page loads: check for key
    window.onload = () => {
      const key = new URLSearchParams(window.location.search).get('k');
      if (key && localStorage.getItem(key)) {
        document.getElementById('setup-view').style.display = 'none';
        document.getElementById('login-view').style.display = 'block';
      }
    };

    // Generate "short link" without exposing full data
    function generateLink() {
      const momName = document.getElementById('momName').value.trim();
      const sonName = document.getElementById('sonName').value.trim();
      const momAge = document.getElementById('momAge').value.trim();
      const sonAge = document.getElementById('sonAge').value.trim();
      if (!momName || !sonName || !momAge || !sonAge) {
        alert('Please fill out all fields!');
        return;
      }

      const data = { m:momName, s:sonName, ma:momAge, sa:sonAge };
      const key = shortKey();
      localStorage.setItem(key, JSON.stringify(data));

      const baseUrl = window.location.href.split('?')[0];
      const finalLink = `${baseUrl}?k=${key}`;

      document.getElementById('generated-link').innerText = finalLink;
      document.getElementById('link-container').style.display = 'block';
    }

    // Verify details
    function checkDetails() {
      const key = new URLSearchParams(window.location.search).get('k');
      if (!key || !localStorage.getItem(key)) {
        alert("Link expired or invalid!");
        return;
      }
      const correctData = JSON.parse(localStorage.getItem(key));

      const momNameGuess = document.getElementById('momNameGuess').value.trim().toLowerCase();
      const sonNameGuess = document.getElementById('sonNameGuess').value.trim().toLowerCase();
      const momAgeGuess = document.getElementById('momAgeGuess').value.trim();
      const sonAgeGuess = document.getElementById('sonAgeGuess').value.trim();

      if (momNameGuess === correctData.m.toLowerCase() &&
          sonNameGuess === correctData.s.toLowerCase() &&
          momAgeGuess === correctData.ma &&
          sonAgeGuess === correctData.sa) {

        document.getElementById('login-view').style.display = 'none';
        const msg = document.getElementById('final-message');
        msg.innerHTML = `
          <h1>Sorry Mummy ❤️</h1>
          <p>
            Sorry for everything... you've been handling me for <strong>${correctData.sa} years</strong>.
            <br><br>You’ve raised me and loved me unconditionally.
            <br><br>Smile karo, cute lagti ho aap! 
            <br><br>Call karna jab gussa shant ho jaye.
            <br><br>- Your Son, ${correctData.s}
          </p>`;
        msg.style.display = 'block';

        confetti({ particleCount: 150, spread: 180, origin: { y: 0.6 } });
      } else {
        alert('Oops! Details do not match.');
      }
    }
  </script>
</body>
</html>
